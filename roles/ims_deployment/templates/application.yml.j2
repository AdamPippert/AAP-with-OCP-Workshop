# Spring Boot Application Configuration Template
# Generated by Ansible for {{ ims_deployment_environment }} environment

server:
  port: 8080
  shutdown: graceful
{% if ims_deployment_environment == 'prod' %}
  ssl:
    enabled: false  # Handled by ingress/route
{% endif %}

spring:
  application:
    name: {{ ims_deployment_app_name }}
  profiles:
    active: {{ ims_deployment_environment }}
  lifecycle:
    timeout-per-shutdown-phase: 30s
{% if ims_deployment_environment == 'dev' %}
  devtools:
    restart:
      enabled: false
{% endif %}

management:
  endpoints:
    web:
      exposure:
        include: health,info,metrics{% if ims_deployment_environment == 'dev' %},env,configprops{% endif %}
  health:
    show-details: always
  metrics:
    enable:
      jvm: true
      system: true
    export:
      prometheus:
        enabled: true

# IMS-specific configuration
ims:
  mainframe:
    host: {{ ims_deployment_config.mainframe_host }}
  database:
    name: {{ ims_deployment_config.database_name }}
  connection:
    pool:
      size: {{ ims_deployment_config.connection_pool_size }}
    timeout: {{ ims_deployment_config.timeout_seconds }}

logging:
  level:
    com.redhat.ims: {{ 'DEBUG' if ims_deployment_environment == 'dev' else 'INFO' }}
    org.springframework: {{ 'DEBUG' if ims_deployment_environment == 'dev' else 'WARN' }}
    root: {{ 'DEBUG' if ims_deployment_environment == 'dev' else 'INFO' }}
  pattern:
    console: "%d{yyyy-MM-dd HH:mm:ss} - %msg%n"
{% if ims_deployment_environment in ['test', 'prod'] %}
  file:
    name: /app/logs/ims-connector.log
    max-size: 10MB
    max-history: 30
{% endif %}